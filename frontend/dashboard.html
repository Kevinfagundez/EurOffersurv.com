<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EurOffersurv</title>

    <link rel="stylesheet" href="/styles.css">

    <style>
        /* Estilos específicos para TheoremReach */
        #theoremreach-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: 600px;
        }
        #theoremreach_offerwall { width: 100%; min-height: 600px; }
        .offerwall-loader {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 3rem; text-align: center;
        }
        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2196f3;
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-card h3 { color: #757575; font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem; }
        .stat-card .stat-value { font-size: 2rem; font-weight: 700; color: #2196f3; }
        .main-content { padding: 2rem; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-left">
            <button class="menu-toggle" id="menuToggle" aria-label="Abrir menú">
                <span></span><span></span><span></span>
            </button>
            <div class="logo">
                <span style="color:green">Eur</span><span style="color:blue">Offersurv.com</span>
            </div>
        </div>

        <div class="navbar-right">
            <div class="notif-wrap" id="notifWrap">
                <button class="notification-btn" id="notifBtn" aria-label="Notificaciones" aria-expanded="false">
                    <svg class="icon-bell" width="20" height="20" viewBox="0 0 24 24" fill="none"
                         xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M12 22a2.2 2.2 0 0 0 2.2-2.2H9.8A2.2 2.2 0 0 0 12 22Z" fill="currentColor"/>
                        <path d="M20 17.2H4c-.6 0-1-.4-1-1 0-.4.2-.7.5-.9l1.2-.7V10a7.3 7.3 0 0 1 5-6.9V2.4c0-.7.6-1.3 1.3-1.3h1c.7 0 1.3.6 1.3 1.3v.7a7.3 7.3 0 0 1 5 6.9v3.6l1.2.7c.3.2.5.5.5.9 0 .6-.4 1-1 1Z"
                              fill="currentColor"/>
                    </svg>
                    <span class="badge" id="notifBadge" hidden>0</span>
                </button>

                <div class="notif-dropdown" id="notifDropdown" hidden>
                    <div class="notif-head">
                        <div class="notif-title">Notificaciones</div>
                        <button class="notif-action" id="notifMarkAllBtn" type="button">Marcar todo como leído</button>
                    </div>
                    <div class="notif-list" id="notifList"></div>
                    <div class="notif-foot">
                        <button class="notif-secondary" id="notifClearBtn" type="button">Limpiar</button>
                        <button class="notif-primary" id="notifRefreshBtn" type="button">Actualizar</button>
                    </div>
                </div>
            </div>

            <div class="user-info">
                <div class="user-avatar">
                    <img src="/img/usuario.png" alt="Usuario">
                </div>
                <div class="user-details">
                    <div class="user-name">Cargando...</div>
                    <div class="user-balance" data-balance>$0.00 USD</div>
                </div>
            </div>

            <button class="btn-withdraw" id="withdrawBtn">Retirar</button>
        </div>
    </nav>

    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <a class="sidebar-link active" onclick="navigateTo('inicio')">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                </svg>
                <span>Inicio</span>
                </a>

                <a class="sidebar-link" onclick="navigateTo('encuestas')">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"/>
                </svg>
                <span>Encuestas</span>
                </a>

                <a class="sidebar-link" onclick="navigateTo('ofertas')">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/>
                </svg>
                <span>Ofertas</span>
                </a>

                <a class="sidebar-link" onclick="navigateTo('recompensas')">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z"/>
                </svg>
                <span>Recompensas</span>
                </a>

                <a class="sidebar-link" onclick="navigateTo('soporte')">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"/>
                </svg>
                <span>Soporte</span>
                </a>

                <div class="sidebar-divider"></div>

                <a class="sidebar-link logout" id="logoutLink" href="/index.html">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z"/>
                    </svg>
                    <span>Cerrar Sesión</span>
                </a>


                <!-- POPUP LOGOUT (estilo notificaciones) -->
                <div class="logout-pop" id="logoutPop" hidden>
                <div class="logout-pop-head">Cerrar sesión</div>
                <div class="logout-pop-body">¿Seguro que deseas cerrar tu sesión?</div>
                <div class="logout-pop-actions">
                    <button type="button" class="logout-pop-btn secondary" id="logoutCancelBtn">Cancelar</button>
                    <button type="button" class="logout-pop-btn danger" id="logoutConfirmBtn">Cerrar sesión</button>
                </div>
                </div>
                
            </nav>
            </aside>


        <main class="main-content">
            <h1 style="margin-bottom: 2rem;">Bienvenido a <span style="color:green">Eur</span><span style="color:blue">Offersurv.com</span></h1>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>BALANCE DISPONIBLE</h3>
                    <div class="stat-value" data-balance>$0.00</div>
                </div>
                <div class="stat-card">
                    <h3>TOTAL GANADO</h3>
                    <div class="stat-value" data-total-earned>$0.00</div>
                </div>
                <div class="stat-card">
                    <h3>OFERTAS COMPLETADAS</h3>
                    <div class="stat-value" data-completed-offers>0</div>
                </div>
            </div>

            <div id="theoremreach-container">
                <div class="offerwall-loader">
                    <div class="loader-spinner"></div>
                    <p style="margin-top: 1rem; color: #757575;">Cargando ofertas disponibles...</p>
                </div>
                <div id="theoremreach_offerwall"></div>
            </div>
        </main>
    </div>

    <script src="/auth.js"></script>
    <script src="/app.js"></script>
    <script src="/theoremreach-integration.js"></script>

        <style>
    /* Popup logout (sidebar) */
    #sidebar { position: relative; }

    .logout-pop {
        position: absolute;
        left: 14px;
        bottom: 62px;
        width: 270px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 12px 30px rgba(0,0,0,0.18);
        border: 1px solid rgba(0,0,0,0.08);
        z-index: 9999;
        overflow: hidden;
    }
    .logout-pop::before {
        content: "";
        position: absolute;
        left: 26px;
        bottom: -8px;
        width: 16px;
        height: 16px;
        background: #fff;
        border-left: 1px solid rgba(0,0,0,0.08);
        border-bottom: 1px solid rgba(0,0,0,0.08);
        transform: rotate(45deg);
    }
    .logout-pop-head {
        padding: 12px 14px;
        font-weight: 800;
        border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .logout-pop-body {
        padding: 12px 14px;
        color: #555;
        font-size: 0.92rem;
    }
    .logout-pop-actions {
        padding: 12px 14px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        border-top: 1px solid rgba(0,0,0,0.06);
        background: rgba(0,0,0,0.02);
    }
    .logout-pop-btn {
        border: none;
        border-radius: 10px;
        padding: 9px 12px;
        font-weight: 700;
        cursor: pointer;
    }
    .logout-pop-btn.secondary { background: #f1f1f1; color: #222; }
    .logout-pop-btn.danger { background: #f44336; color: #fff; }
    .logout-pop-btn:hover { opacity: 0.92; }
    </style>

    <script>
    (function () {
        const link = document.getElementById("logoutLink");
        const sidebar = document.getElementById("sidebar");
        if (!link || !sidebar) return;

        // crear popup una sola vez
        let pop = document.getElementById("logoutPop");
        if (!pop) {
        pop = document.createElement("div");
        pop.id = "logoutPop";
        pop.className = "logout-pop";
        pop.hidden = true;
        pop.innerHTML = `
            <div class="logout-pop-head">Cerrar sesión</div>
            <div class="logout-pop-body">¿Seguro que deseas cerrar tu sesión?</div>
            <div class="logout-pop-actions">
            <button type="button" class="logout-pop-btn secondary" id="logoutCancelBtn">Cancelar</button>
            <button type="button" class="logout-pop-btn danger" id="logoutConfirmBtn">Cerrar sesión</button>
            </div>
        `;
        sidebar.appendChild(pop);
        }

        const cancelBtn = () => document.getElementById("logoutCancelBtn");
        const confirmBtn = () => document.getElementById("logoutConfirmBtn");

        function open() { pop.hidden = false; }
        function close() { pop.hidden = true; }
        function toggle() { pop.hidden ? open() : close(); }

        link.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        toggle();
        });

        document.addEventListener("click", (e) => {
        if (pop.hidden) return;
        if (pop.contains(e.target) || link.contains(e.target)) return;
        close();
        });

        document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") close();
        });

        // cancelar
        document.addEventListener("click", (e) => {
        if (e.target && e.target.id === "logoutCancelBtn") {
            e.preventDefault();
            e.stopPropagation();
            close();
        }
        });

        // confirmar logout real
        document.addEventListener("click", async (e) => {
        if (!(e.target && e.target.id === "logoutConfirmBtn")) return;
        e.preventDefault();
        e.stopPropagation();

        const btn = confirmBtn();
        if (btn) {
            btn.disabled = true;
            btn.textContent = "Cerrando...";
        }

        try {
            // si existe auth.logout úsalo, sino redirige igual
            if (window.auth && typeof window.auth.logout === "function") {
            await window.auth.logout();
            }
        } catch (err) {
            console.error("Logout error:", err);
        } finally {
            close();
            window.location.href = "/index.html";
        }
        });
    })();
    </script>

</body>
</html>
